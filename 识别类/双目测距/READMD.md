```markdown
# 📐 双目视觉测距系统（YOLO + OpenCV + SGBM）

本项目基于 **双目摄像头 + YOLO 目标检测 + OpenCV SGBM 视差计算**，实现对指定目标（如笔记本电脑）进行距离测量。

## 🔧 项目功能概述

- 使用 YOLO 模型检测目标（当前为笔记本电脑）
- 对左右图像进行立体校正和 ROI 区域提取
- 利用 SGBM 算法计算视差图
- 生成深度图，估算最小/平均目标距离
- 支持可视化视差图与深度图保存
- 输出测距结果为文本文件

## 📁 项目结构

```
├── left.jpg                   # 左摄像头图像
├── right.jpg                  # 右摄像头图像
├── yolo11n.pt                 # 训练好的YOLO模型（需放置在项目根目录）
├── main.py                    # 主程序
├── 深度图.png                 # 输出的伪彩色深度图
├── 视差图.png                 # 输出的灰度视差图
├── 结果.txt                   # 测量结果（最小/平均距离）
└── README.md                  # 项目说明文档
```

## 🧰 环境依赖

确保使用 Python 3.8+，安装以下依赖项：

```bash
pip install opencv-python opencv-contrib-python numpy ultralytics
```

建议使用虚拟环境运行项目（如 `venv` 或 `conda`）。

## ▶️ 使用说明

1. **准备图像**
   - 采集左右图像并命名为 `left.jpg` 和 `right.jpg`
   - 保证图像对齐且目标清晰可见

2. **放置模型文件**
   - 将训练好的 YOLOv8 模型（如 `yolo11n.pt`）放置在项目根目录

3. **运行程序**

```bash
python main.py
```

4. **查看输出**
   - 输出图像：`视差图.png`、`深度图.png`
   - 距离结果：`结果.txt`

## 📌 注意事项

- **目标类别限制**：当前仅检测类别 `63`（笔记本），如需更换请修改：

```python
results = model(left_img, save=True, imgsz=640, conf=0.5, classes=[63])
```

- **图像尺寸影响焦距计算**：当前按 640 像素宽度估算，调整时需同步更新焦距计算逻辑。

- **相机参数为理想值**：实际应用中建议使用实测标定参数替换当前默认设置。

- **深度图无效值处理**：视差为0的区域（黑色）不参与有效距离计算。

## ❓ 常见问题

- **Q: YOLO 无法检测目标？**  
  A: 请确保图像目标明显，或者降低 `conf` 参数提升检测灵敏度。

- **Q: 距离数值不准确？**  
  A: 检查图像是否对齐、相机参数是否合理，建议相机标定后替换默认内参。

- **Q: 报错 “未在左图像中检测到物体”？**  
  A: 图像中目标未被识别，请确认模型文件正确且图像中目标清晰。

## 📬 联系方式

如有问题可提交 Issue 或通过邮箱反馈建议。
```